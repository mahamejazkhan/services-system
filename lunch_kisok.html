<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wopla - Lunch Kiosk Order Management</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* CSS styles */
        :root {
            --primary-color: #48bb78;     /* Wopla Green */
            --secondary-color: #6c7381;   /* Dark Text */
            --background-light: #464141;  
            --page-bg: #284d41;           
            --active-bg: #404241;         
            --danger-color: #e53e3e;      
            --grey-text: #718096;
            --border-light: #83a3cd;
            --accent-blue: #3182ce;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: var(--page-bg); min-height: 100vh; }
        a { text-decoration: none; }
        .dashboard-wrapper { display: flex; min-height: 100vh; }

        /* Sidebar Styles */
        .sidebar { width: 250px; background-color: var(--background-light); box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05); position: sticky; top: 0; height: 100vh; }
        .sidebar .logo { height: 75px; display: flex; justify-content: center; align-items: center; border-bottom: 1px solid var(--border-light); }
        .sidebar h2 { color: var(--secondary-color); font-size: 20px; font-weight: 700; }
        .sidebar ul { list-style: none; padding: 0; }
        .sidebar li { padding: 0 15px; margin-bottom: 5px; }
        .sidebar a { display: flex; align-items: center; padding: 10px 10px; color: var(--grey-text); font-size: 16px; border-radius: 6px; font-weight: 500; }
        .sidebar li.active > a { background-color: var(--active-bg); color: var(--primary-color); font-weight: 600; }
        .nav-title { color: #a0aec0; font-size: 12px; padding: 15px 15px 5px; text-transform: uppercase; }
        .sidebar li.logout { padding: 0; margin-top: 30px; border-top: 1px solid var(--border-light); }

        /* Main Content Styles */
        .main-content { flex-grow: 1; }
        .topbar { height: 75px; display: flex; justify-content: space-between; align-items: center; padding: 20px 30px; background-color: var(--background-light); box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); border-bottom: 3px solid var(--border-light); }
        .page-title h1 { color: var(--secondary-color); font-weight: 600; }
        .page-container { padding: 30px; }
        .card { background-color: var(--background-light); padding: 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); }

        /* Table Styles */
        .order-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .order-table th, .order-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border-light); }
        .order-table th { background-color: #70747b; color: #4a5568; font-weight: bold; }
        .highlight-count { font-weight: 700; color: var(--secondary-color); font-size: 1.1em; }
        .total-row { background-color: #abcec7; font-weight: bold; }
        
        /* Interactive Buttons */
        .count-controls button {
            background: none; border: 1px solid var(--border-light); padding: 5px 10px; cursor: pointer; 
            border-radius: 4px; margin: 0 5px; font-weight: bold; transition: background-color 0.2s;
        }
        .btn-add-dish {
            background-color: var(--accent-blue); color: rgb(154, 132, 132); padding: 10px 15px; border: rgb(41, 40, 38); 
            border-radius: 5px; font-weight: 600; cursor: pointer; transition: background-color 0.2s;
        }
        .btn-add-dish:hover { background-color: #2b6cb0; }

        /* Modal Styles */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); }
        .modal-content { background-color: var(--background-light); margin: 10% auto; padding: 30px; border-radius: 10px; width: 90%; max-width: 400px; position: relative;}
        .modal-content h3 { margin-bottom: 20px; }
        .modal-content input { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid var(--border-light); border-radius: 4px; }
    </style>
</head>
<body>
    
    <div class="dashboard-wrapper">
        <aside class="sidebar">
            <div class="logo"><h2>Wopla Admin</h2></div>
            <nav class="nav-links">
                <ul>
                    <li><a href="superadmin.html"><i class="fas fa-chart-bar"></i> Dashboard</a></li>
                    <li class="nav-title">Service Management</li>
                    <li class="active"><a href="#"><i class="fas fa-utensils"></i> Lunch Kiosk</a></li> 
                    <li><a href="#"><i class="fas fa-home"></i> Home Order</a></li>
                    <li><a href="#"><i class="fas fa-apple-alt"></i> Fruit Order</a></li>
                    <li class="nav-title">User & Admin Management</li>
                    <li><a href="client_management.html"><i class="fas fa-user-tie"></i> Client Admin</a></li> 
                    <li><a href="vendors.html"><i class="fas fa-truck"></i> Vendor</a></li>
                    <li class="logout"><a href="login.html"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                </ul>
            </nav>
        </aside>

        <div class="main-content">
            
            <header class="topbar">
                <div class="page-title"><h1>Lunch Kiosk Orders <i class="fas fa-utensils"></i></h1></div>
                <div class="admin-info">Welcome, Super Admin!</div>
            </header>

            <main class="page-container">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h2 style="color: var(--secondary-color);">Dish Orders Overview</h2>
                        <button class="btn-add-dish" id="openAddDishModal">
                            <i class="fas fa-plus-circle"></i> **Add New Dish**
                        </button>
                    </div>
                    <p style="color: var(--grey-text);">Delivery Date: **2025-10-25**</p>
                    
                    <table class="order-table">
                        <thead>
                            <tr>
                                <th>Dish Name</th>
                                <th>Order Count</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody **id="dishTableBody"**>
                            <tr data-dish-id="1">
                                <td>**Chicken Biryani**</td>
                                <td><span class="highlight-count count-display" data-count="45">45</span></td>
                                <td>
                                    <div class="count-controls">
                                        <button onclick="changeCount(1, -1)">-</button>
                                        <button onclick="changeCount(1, 1)">+</button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-dish-id="2">
                                <td>**Vegetable Pulao**</td>
                                <td><span class="highlight-count count-display" data-count="22">22</span></td>
                                <td>
                                    <div class="count-controls">
                                        <button onclick="changeCount(2, -1)">-</button>
                                        <button onclick="changeCount(2, 1)">+</button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-dish-id="3">
                                <td>**Daal Makhani & Roti**</td>
                                <td><span class="highlight-count count-display" data-count="38">38</span></td>
                                <td>
                                    <div class="count-controls">
                                        <button onclick="changeCount(3, -1)">-</button>
                                        <button onclick="changeCount(3, 1)">+</button>
                                    </div>
                                </td>
                            </tr>
                            <tr class="total-row">
                                <td>**TOTAL ORDERS**</td>
                                <td colspan="2"><span **id="totalDishesCount"**>0</span></td> 
                            </tr>
                        </tbody>
                    </table>
                </div>
            </main>
        </div>
    </div>

    <div **id="addDishModal"** class="modal">
        <div class="modal-content">
            <span class="close-btn" style="float: right; font-size: 28px; position: absolute; top: 10px; right: 20px; cursor: pointer;">&times;</span>
            <h3>Add New Dish for Kiosk</h3>
            <form **id="newDishForm"**>
                <input type="text" id="newDishName" placeholder="Enter Dish Name" required>
                <input type="number" id="initialCount" placeholder="Initial Order Count" value="1" min="0" required>
                <button type="submit" class="btn-add-dish" style="width: 100%;"><i class="fas fa-plus"></i> Add Dish</button>
            </form>
        </div>
    </div>

    <script>
        // Global counter to ensure unique IDs for new dishes (Starting at 5 because we have 4 hardcoded)
        let dishIdCounter = 5; 

        // --- 1. COUNT CHANGE FUNCTION (Called by + / - buttons) ---
        function changeCount(dishId, change) {
            const row = document.querySelector(`tr[data-dish-id="${dishId}"]`);
            if (!row) return;

            const countDisplay = row.querySelector('.count-display');
            let currentCount = parseInt(countDisplay.getAttribute('data-count'));
            
            // Count can't go below 0
            let newCount = Math.max(0, currentCount + change);

            // Update attributes and displayed text
            countDisplay.setAttribute('data-count', newCount);
            countDisplay.textContent = newCount;
            
            updateTotalCount();
        }

        // --- 2. UPDATE TOTAL COUNT FUNCTION (Fixes the "0" issue) ---
        function updateTotalCount() {
            // Select all count displays in the table body
            const allCounts = document.querySelectorAll('#dishTableBody .count-display');
            ;
            
            allCounts.forEach(el => {
                // Get the data-count attribute value and parse it as an integer
                // || 0 ensures that if parsing fails, it defaults to 0, preventing NaN
                total += parseInt(el.getAttribute('data-count')) ; 
            });
            
            const totalDisplay = document.getElementById('totalDishesCount');
            if(totalDisplay) {
                totalDisplay.textContent = total;
            }
        }

        // --- 3. ADD NEW DISH FUNCTION ---
        function addNewDish(name, count) {
            const tbody = document.getElementById('dishTableBody');
            if (!tbody) return;
            
            const newId = dishIdCounter++;
            const newRow = document.createElement('tr');
            newRow.setAttribute('data-dish-id', newId);
            
            newRow.innerHTML = `
                <td>${name}</td>
                <td><span class="highlight-count count-display" data-count="${count}">${count}</span></td>
                <td>
                    <div class="count-controls">
                        <button onclick="changeCount(${newId}, -1)">-</button>
                        <button onclick="changeCount(${newId}, 1)">+</button>
                    </div>
                </td>
            `;
            
            // New row ko Total Row se pehle insert karein
            const totalRow = tbody.querySelector('.total-row');
            tbody.insertBefore(newRow, totalRow);
            
            updateTotalCount();
            alert(`SUCCESS: New dish "${name}" added with initial count ${count}.`);
        }

        // --- 4. MODAL AND FORM LOGIC ---
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('addDishModal');
            const openBtn = document.getElementById('openAddDishModal');
            const closeBtn = modal ? modal.querySelector('.close-btn') : null;
            const form = document.getElementById('newDishForm');

            // Modal Open/Close Logic
            if (openBtn && modal) {
                openBtn.addEventListener('click', () => { modal.style.display = "block"; });
            }
            if (closeBtn && form) {
                closeBtn.addEventListener('click', () => { modal.style.display = "none"; form.reset(); });
            }
            // Close modal when clicking outside
            window.addEventListener('click', (event) => { 
                if (modal && event.target === modal) { 
                    modal.style.display = "none"; 
                    if (form) form.reset(); 
                } 
            });

            // Form Submission Logic (Add New Dish)
            if (form) {
                form.addEventListener('submit', function(event) {
                    event.preventDefault();
                    const name = document.getElementById('newDishName').value;
                    const countInput = document.getElementById('initialCount').value;
                    // Input ko integer mein badalna zaroori hai
                    const count = parseInt(countInput); 
                    
                    if (name && !isNaN(count) && count >= 0) {
                        addNewDish(name, count);
                        modal.style.display = "none";
                        form.reset();
                    } else {
                        alert("Error: Please enter a valid Dish Name and non-negative Count.");
                    }
                });
            }

            // Initial total calculation jab page load ho
            updateTotalCount();
        });
    </script>
</body>
</html>